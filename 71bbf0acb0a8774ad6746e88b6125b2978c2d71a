{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "99745ed7_1a993364",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 753
      },
      "writtenOn": "2022-11-09T21:35:02Z",
      "side": 0,
      "message": "Moving this code into the tenant_vars/*/*.yml files is good but it requires more work: ansible-pull on VMs will call include_vars() to load this tenant_vars/common.yml and then those values will be used on the VMs. For example, the rrcockpit_mtu value is used on our upstream cockpit to set the right MTU in docker.\n\nSo in the end this means we have to change this patch to not only include tenant_vars/common.yml but also tenant_vars/{{ tenant }}/.\n\nFor that, VMs have to know which tenants they are in. This can be done e.g. by changing\n\n  ... ansible_connection\u003dlocal\u0027 \u003e  /etc/ansible/hosts\n\nto \n\n  ... ansible_connection\u003dlocal tenant\u003d{{ tenant }}\u0027 \u003e  /etc/ansible/hosts\n\nin the cloud-init userdata of all servers.",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9add15c2_86322f25",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 753
      },
      "writtenOn": "2022-11-09T21:40:02Z",
      "side": 0,
      "message": "Since this is a change to userdata, we would have to manually apply these changes on our running infra before merging this patch, else we will have trouble with our cockpit.",
      "parentUuid": "99745ed7_1a993364",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "595c19ea_61d9e780",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 756
      },
      "writtenOn": "2022-11-09T22:43:34Z",
      "side": 0,
      "message": "I\u0027m not following what you mean.\nrrcockpit is moved to tenant_vars/\u003ctenant\u003e/common.yml specifically for this purpose. When it\u0027s gonna be deployed per tenant, it\u0027s gonna use its own variable.\n\nWhy do you need \"tenant\" value in /etc/ansible/hosts ?",
      "parentUuid": "9add15c2_86322f25",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4a2ebd7a_b55bb48f",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 756
      },
      "writtenOn": "2022-11-09T22:59:25Z",
      "side": 0,
      "message": "rrcockpit_mtu definition:\nhttps://review.rdoproject.org/r/c/rdo-infra/ci-config/+/46001/4/ci-scripts/infra-setup/tenant_vars/rhos-dev-stage/common.yml#6",
      "parentUuid": "595c19ea_61d9e780",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a617471d_9e566bea",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 753
      },
      "writtenOn": "2022-11-10T08:18:14Z",
      "side": 0,
      "message": "tenant_vars/\u003ctenant\u003e/common.yml is not sourced by ansible, so when ansible-pull runs on the VMs, they wont see the rrcockpit_mtu. The only thing that is sourced is tenant_vars/common.yml:\n\nhttps://github.com/rdo-infra/ci-config/blob/71bbf0acb0a8774ad6746e88b6125b2978c2d71a/ci-scripts/infra-setup/servers_setup.yml#L10",
      "parentUuid": "4a2ebd7a_b55bb48f",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8af548d7_37bdefeb",
        "filename": "ci-scripts/infra-setup/tenant_vars/common.yml",
        "patchSetId": 4
      },
      "lineNbr": 19,
      "author": {
        "id": 753
      },
      "writtenOn": "2022-11-10T09:52:01Z",
      "side": 0,
      "message": "I have refactored the current inventory structure and then applied your patch on top of that. It has to be done in three separate steps to not break our existing env:\n\nhttps://review.rdoproject.org/r/q/topic:ansible-inventory\n\nYour patch in that series has a different change id than this patch here (but still the same patch with you as author) because i did not want to overwrite your work here.\n\nLets meet to discuss what i did and why i did it that way.",
      "parentUuid": "a617471d_9e566bea",
      "revId": "71bbf0acb0a8774ad6746e88b6125b2978c2d71a",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7"
    }
  ]
}