{
  "comments": [
    {
      "key": {
        "uuid": "1ae5cdf2_044b1cb1",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "are we doing it this way (heredoc scripts) so that we\u0027re analagous to how an eventual replacement (ansible) role will look (e.g. .sh.j2)",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 30
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_24601835",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 49,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "we should virt-copy-out /tmp/builder.log, to have the ouput, as well as pull the log files generated by the image build itself.  nearly every time we have failures (infra or otherwise) we end up needing those logs.",
      "range": {
        "startLine": 48,
        "startChar": 0,
        "endLine": 49,
        "endChar": 72
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_44cc4436",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 49,
      "author": {
        "id": 84
      },
      "writtenOn": "2016-12-06T22:19:10Z",
      "side": 1,
      "message": "ya I put a TODO on 61 for that. I intend to work on that ASAP, since as you said it is often needed. Just don\u0027t want to block master promote on it.",
      "parentUuid": "1ae5cdf2_24601835",
      "range": {
        "startLine": 48,
        "startChar": 0,
        "endLine": 49,
        "endChar": 72
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_0474fcfb",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "alternative is \u0027virt-copy-out\u0027 instead of one big guestfish.  upside is that if/when something fails, it will be really clear which failed.",
      "range": {
        "startLine": 51,
        "startChar": 0,
        "endLine": 59,
        "endChar": 3
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_64d140cd",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 84
      },
      "writtenOn": "2016-12-06T22:19:10Z",
      "side": 1,
      "message": "makes sense, I will update that in the next patch",
      "parentUuid": "1ae5cdf2_0474fcfb",
      "range": {
        "startLine": 51,
        "startChar": 0,
        "endLine": 59,
        "endChar": 3
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_44652444",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 151,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "we might consider adding --check-tmpdir \u003cflag\u003e defaulting \n\n- More info: http://libguestfs.org/virt-sparsify.1.html\n\n- https://github.com/redhat-openstack/ansible-role-tripleo-image-build/blob/master/defaults/main.yml#L103\n\n- https://github.com/redhat-openstack/ansible-role-tripleo-image-build/blob/master/tasks/undercloud_inject.yml#L13",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 151,
        "endChar": 55
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_84d64cc4",
        "filename": "ci-scripts/build-images.sh",
        "patchSetId": 2
      },
      "lineNbr": 151,
      "author": {
        "id": 84
      },
      "writtenOn": "2016-12-06T22:19:10Z",
      "side": 1,
      "message": "not sure what you mean here... I took the default from the image build role for --check-tmpdir on 150.",
      "parentUuid": "1ae5cdf2_44652444",
      "range": {
        "startLine": 149,
        "startChar": 0,
        "endLine": 151,
        "endChar": 55
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_e4763006",
        "filename": "jenkins/jobs/promote-master.yml",
        "patchSetId": 2
      },
      "lineNbr": 113,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "I realize we have precedent here, but fwiw raw-escape has 2 main downsides that I know of:\n\n1. jjb labels/params are not allowed, so \u0027master\u0027 can\u0027t be turned into a variable, so we end up needing per branch templates, instead of one simple template with inputs (master, newton, etc)\n\n2. changing anything requires a JJB push, vs. simply changing a script called from the builder\n\nI realize we\u0027re just running fast here, but figured would chime in.  I\u0027m working on a re-write of the internal pipelines to get away from this, as with 8+ pipes and growing it\u0027s becoming error prone and ugly",
      "range": {
        "startLine": 111,
        "startChar": 0,
        "endLine": 113,
        "endChar": 56
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_c485b4ae",
        "filename": "jenkins/jobs/promote-master.yml",
        "patchSetId": 2
      },
      "lineNbr": 113,
      "author": {
        "id": 84
      },
      "writtenOn": "2016-12-06T22:19:10Z",
      "side": 1,
      "message": "ya there is a card to completely scrap these pipelines as they exist, so for now I would just like to follow the precedent.",
      "parentUuid": "1ae5cdf2_e4763006",
      "range": {
        "startLine": 111,
        "startChar": 0,
        "endLine": 113,
        "endChar": 56
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_e44d50c6",
        "filename": "jenkins/jobs/scripts/promote-build-images-master.sh",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 202
      },
      "writtenOn": "2016-12-06T21:17:04Z",
      "side": 1,
      "message": "ahhh ok...is this why we have \"the one script that emits other scripts?\"",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 26,
        "endChar": 108
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1ae5cdf2_649f8004",
        "filename": "jenkins/jobs/scripts/promote-build-images-master.sh",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 84
      },
      "writtenOn": "2016-12-06T22:19:10Z",
      "side": 1,
      "message": "ya, so we dont have to copy multiple scripts to the virthost.\n\nIt was in designing this that I realized we probably still do want an ansible role, since the remote execution aspect alone would make this much nicer.\n\nanother reason for the build script with heredocs is that it is a self-contained script that can be run outside of CI to build a master image, and in fact is how I tested this.",
      "parentUuid": "1ae5cdf2_e44d50c6",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 26,
        "endChar": 108
      },
      "revId": "888896db80f99ade92bc901ace9b634d99308573",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    }
  ]
}