{
  "comments": [
    {
      "key": {
        "uuid": "33192d4a_f41a5a58",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 55,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:03:32Z",
      "side": 1,
      "message": "So this assumes that every project has a zuul.yaml definition file. I suppose it is the case for every project on rdo and downstream.",
      "range": {
        "startLine": 55,
        "startChar": 77,
        "endLine": 55,
        "endChar": 87
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "631e9ca5_af4b6d49",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 55,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "So, this will work even if file name is different for example: projects.yaml - the only assumption we are making here is that file name contains a `.yaml` extension.\n\n~~~\n$ ./ci-scripts/node_holder/node_holder.py -a https://review.rdoproject.org/r/c/rdo-jobs/+/37139/1/zuul.d/projects.yaml\n\nPatch: https://review.rdoproject.org/r/c/rdo-jobs/+/37139/1/zuul.d/projects.yaml contains more than 1 job, please pass --job_name \u003cname of job\u003e which job you want to hold\n~~~",
      "parentUuid": "33192d4a_f41a5a58",
      "range": {
        "startLine": 55,
        "startChar": 77,
        "endLine": 55,
        "endChar": 87
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dbb077a4_eaa9718d",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 55,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "to be precise, the jobs need to be defined in the project itself. Sometimes a project may inherit its jobs config from another project and you won\u0027t have access to it, as there may not even be a yaml definition file in the project. This may not be the case on rdo or downstream so it\u0027s maybe a moot point.\n\nYou could also query the builds API on zuul to fetch the last failing buildset and look for the failing jobs in the buildset. These are likely the ones you want to hold.",
      "parentUuid": "631e9ca5_af4b6d49",
      "range": {
        "startLine": 55,
        "startChar": 77,
        "endLine": 55,
        "endChar": 87
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0beb37c_0597d165",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 55,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-17T04:49:15Z",
      "side": 1,
      "message": "Thank Matthieu for the explanation.\n\n~95% time we hold nodes for testproject and sometimes for rdo-jobs project - In both projects , job is defined in the project itself. We have same situation in the downstream for the projects we are involved.\n\nThanks for the sharing intersting idea about querying zuul build api ðŸ˜Š",
      "parentUuid": "dbb077a4_eaa9718d",
      "range": {
        "startLine": 55,
        "startChar": 77,
        "endLine": 55,
        "endChar": 87
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa607d56_7a3c0878",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 122,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:03:32Z",
      "side": 1,
      "message": "Is this actually deleting an autohold request? Deleting a node requires access to nodepool\u0027s admin CLI.",
      "range": {
        "startLine": 122,
        "startChar": 0,
        "endLine": 122,
        "endChar": 16
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79207968_2a8c3f67",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 122,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "Hey Matthieu,\n\n\nI didn\u0027t understand your comment completely:-\n\nWith delete I mean the task, corresponding to the below command:-\n~~~\npodman run --rm --name zc_container -v $HOME/.config/zuul/:/config:Z zuul/zuul-client:latest -c /config/client.conf --use-config rdoproject.org autohold-delete \u003cid\u003e\n~~~\n\n\n* Do you mean we should reframe the wordings here - Remove a node from autohold?\n* Or are you asking if this removing a node from autohold is working?",
      "parentUuid": "aa607d56_7a3c0878",
      "range": {
        "startLine": 122,
        "startChar": 0,
        "endLine": 122,
        "endChar": 16
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0465e0bf_dd89f02d",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 122,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "this command deletes the autohold query, it does not delete any node that may have been held due to this query. Node cleaning will be done automatically by nodepool\u0027s scheduler, or manually by an operator. I wanted to make sure the differnce was clear.",
      "parentUuid": "79207968_2a8c3f67",
      "range": {
        "startLine": 122,
        "startChar": 0,
        "endLine": 122,
        "endChar": 16
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96f391b8_54703b72",
        "filename": "ci-scripts/node_holder/README.md",
        "patchSetId": 8
      },
      "lineNbr": 122,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-17T04:49:15Z",
      "side": 1,
      "message": "Ahh, make sense now, I was under impression autohold-delete also removes the nodes.\n\nI will update docs here in the next patchset.",
      "parentUuid": "0465e0bf_dd89f02d",
      "range": {
        "startLine": 122,
        "startChar": 0,
        "endLine": 122,
        "endChar": 16
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "909ff029_149c265e",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:03:32Z",
      "side": 1,
      "message": "Why disable SSL verification? I think certificates in rdo and downstream use a valid CA.",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "212e4ea4_fb57fd26",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "Good point, I will remove disable SSL in the next patchset.\n\nI added that originally because I was getting warnings I guess I don\u0027t have correct local certificates in my local system(need to dig deeper)",
      "parentUuid": "909ff029_149c265e",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6236ccb_78df338b",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "212e4ea4_fb57fd26",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a60c1b7c_6c22cca9",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-17T04:49:15Z",
      "side": 1,
      "message": "Thanks Matthieu,\n\nI am facing some issue switching this to verify\u003dTrue for downstream case.\n\n~~~\n(Caused by SSLError(SSLCertVerificationError(1, \u0027[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129\n~~~\n\nI am still figuring that out if verify\u003dTrue should be enough or we need to add some custom certificate patch to verify\u003d\u0027/patch/to/custom_certificate\u0027 for downstream case.",
      "parentUuid": "e6236ccb_78df338b",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7e70245f_765a3ee5",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-17T04:50:42Z",
      "side": 1,
      "message": "correcting typo:-\n\nI am still figuring that out if verify\u003dTrue should be enough or we need to add some custom certificate path* to verify\u003d\u0027/path/to/custom_certificate\u0027 for downstream case.",
      "parentUuid": "a60c1b7c_6c22cca9",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a5dc70c_52dbfada",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 119,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-17T09:44:47Z",
      "side": 1,
      "message": "I don\u0027t want to block you on this, so if you want to merge this and add SSL verification later, I\u0027m cool with that.",
      "parentUuid": "7e70245f_765a3ee5",
      "range": {
        "startLine": 119,
        "startChar": 33,
        "endLine": 119,
        "endChar": 45
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "99421674_ddd81776",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 194,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:03:32Z",
      "side": 1,
      "message": "same remark about SSL",
      "range": {
        "startLine": 194,
        "startChar": 13,
        "endLine": 194,
        "endChar": 59
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b207369_06331615",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 194,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "thanks, I will remove disable SSL in the next patchset.",
      "parentUuid": "99421674_ddd81776",
      "range": {
        "startLine": 194,
        "startChar": 13,
        "endLine": 194,
        "endChar": 59
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "958816f5_deeb2a57",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 194,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5b207369_06331615",
      "range": {
        "startLine": 194,
        "startChar": 13,
        "endLine": 194,
        "endChar": 59
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3054c29e_85bcc11b",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 263,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:05:45Z",
      "side": 1,
      "message": "this is the default path to the config file, but this could live somewhere else.",
      "range": {
        "startLine": 263,
        "startChar": 35,
        "endLine": 263,
        "endChar": 60
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f3e44540_1f067dab",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 263,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "Correct,  I have not added a variable for this because I want to keep cli options to minimum.\n\nI have documented in L#417 about the assumption that we expect a file at $HOME/.config/zuul/client.conf.\n\n~~~\n./ci-scripts/node_holder/node_holder.py --help\n\nScript to add a node on hold for debug, this script assumes you have a config file(containing: url/tenant/auth_token) at $HOME/.config/zuul/client.conf. You need to request someone from infra to create a token for you.\n~~~",
      "parentUuid": "3054c29e_85bcc11b",
      "range": {
        "startLine": 263,
        "startChar": 35,
        "endLine": 263,
        "endChar": 60
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8cd01bd4_f4a21f77",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 263,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "I can live with this! ðŸ˜Š",
      "parentUuid": "f3e44540_1f067dab",
      "range": {
        "startLine": 263,
        "startChar": 35,
        "endLine": 263,
        "endChar": 60
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "144b0522_2efdb2df",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 399,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T10:05:45Z",
      "side": 1,
      "message": "This assumes the config files has entries named \u0027rdoproject.org\u0027 and \u0027tripleo-ci-internal\u0027",
      "range": {
        "startLine": 396,
        "startChar": 1,
        "endLine": 399,
        "endChar": 38
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7d93fed_eef87671",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 399,
      "author": {
        "id": 671
      },
      "writtenOn": "2021-12-16T16:13:43Z",
      "side": 1,
      "message": "Yes, I made that assumption to pass cli option easier: \u0027--config rdo\u0027, I will try to document this better in next patchset.",
      "parentUuid": "144b0522_2efdb2df",
      "range": {
        "startLine": 396,
        "startChar": 1,
        "endLine": 399,
        "endChar": 38
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af835e08_0087e3ad",
        "filename": "ci-scripts/node_holder/node_holder.py",
        "patchSetId": 8
      },
      "lineNbr": 399,
      "author": {
        "id": 73
      },
      "writtenOn": "2021-12-16T16:36:16Z",
      "side": 1,
      "message": "same, this is nit level since this tool is internal.",
      "parentUuid": "b7d93fed_eef87671",
      "range": {
        "startLine": 396,
        "startChar": 1,
        "endLine": 399,
        "endChar": 38
      },
      "revId": "94aecd97e3a55d0ab265c44b8be9f1f60aac7c68",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    }
  ]
}