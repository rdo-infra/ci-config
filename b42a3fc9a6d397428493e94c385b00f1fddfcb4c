{
  "comments": [
    {
      "key": {
        "uuid": "9b922038_6ff2ccb4",
        "filename": "jenkins-v2/jobs/scripts/weirdo-collect-logs.sh",
        "patchSetId": 9
      },
      "lineNbr": 1,
      "author": {
        "id": 403
      },
      "writtenOn": "2021-06-25T14:58:44Z",
      "side": 1,
      "message": "to get log collection working i had to change as below:-\n\n# weirdo-collect-logs.sh\n# A script to collect logs generated by a weirdo job\npushd $WORKSPACE\nexport LOG_DISPLAY_URL\u003d\"https://logserver.rdoproject.org/ci.centos.org/${JOB_NAME}/${BUILD_NUMBER}\"\nexport DESTINATION\u003d\"/var/www/logs/ci.centos.org/${JOB_NAME}/${BUILD_NUMBER}\"\n\n# Install dependencies\n[[ ! -d provision_venv ]] \u0026\u0026 python3 -m venv provision_venv\nsource provision_venv/bin/activate\npip install -U pip\npip install ansible\u003d\u003d2.9.16 \u0027Django\u003c2.2\u0027 ara[server] shade\n\nexport ANSIBLE_HOST_KEY_CHECKING\u003dFalse\nexport ANSIBLE_CALLBACK_PLUGINS\u003d\"$(python3 -m ara.setup.callback_plugins)\"\nexport ARA_DATABASE_NAME\u003d\"$WORKSPACE/$JOB_NAME.sqlite\"\n\n# Recover console log, generate and upload ARA report\nara-manage generate \"${WORKSPACE}/ara\" || true\n\n# Copy database (experimental)\nmkdir ${WORKSPACE}/ara-database\ncp ${WORKSPACE}/${JOB_NAME}.sqlite ${WORKSPACE}/ara-database/ansible.sqlite\n\ndeactivate\n\n# Don\u0027t fail script execution even if log collection fails -- the node needs to be destroyed afterwards\npushd weirdo\ntox -e ansible-playbook -- -vv -i $WORKSPACE/hosts playbooks/logs-ci-centos.yml -e ci_environment\u003dci-centos || true\npopd\npopd",
      "revId": "b42a3fc9a6d397428493e94c385b00f1fddfcb4c",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b52b4d3_de5e2cb5",
        "filename": "jenkins-v2/jobs/scripts/weirdo-collect-logs.sh",
        "patchSetId": 9
      },
      "lineNbr": 1,
      "author": {
        "id": 635
      },
      "writtenOn": "2021-06-29T08:03:14Z",
      "side": 1,
      "message": "Right, I didn\u0027t push the ARA part even though it was present in my testing job.",
      "parentUuid": "9b922038_6ff2ccb4",
      "revId": "b42a3fc9a6d397428493e94c385b00f1fddfcb4c",
      "serverId": "270e2033-b340-4cff-9539-693957ebf0e7",
      "unresolved": false
    }
  ]
}