# Host variables
# Comment this if you're not runnint ansible from virtualenv
python_interpreter: "{{ lookup('env', 'VIRTUAL_ENV') }}/bin/python"

# Workflow defaults
servers_teardown:
    include_role: false
    # These must be a list or "*" to include all servers
    include_servers:
    include_volumes:
general_teardown:
    include_role: false

# tenant defaults
default_image: &default_image CentOS-7-x86_64-GenericCloud-1708
default_flavor: &default_flavor m1.medium

servers_key: &servers_key servers_key

bastion_public_ip: &bastion_public_ip 3.4.5.5
bastion_key: &bastion_key rdo-tripleo-ci-infra

generated_content_basedir: "{{ lookup('env', 'HOME')}}/"

internal_network: &internal_network private
internal_nics: &internal_nics
    - net-name: *internal_network

tenants:
    gcerami:
        #    openstack-infra:
        security_groups:
            - name: &ssh_from_bastion ssh_from_bastion
              rules:
                - protocol: tcp
                  port_range_min: 22
                  port_range_max: 22
                  remote_ip_prefix: *bastion_public_ip
            - name: &ssh_from_everywhere ssh_from_everywhere
              rules:
                - protocol: tcp
                  port_range_min: 22
                  port_range_max: 22
                  remote_ip_prefix: 0.0.0.0/0
        keypairs:
            - name: *bastion_key
              public_key_file: rdo-tripleo-ci-infra.keys
            - name: *servers_key
              generate: true
        networks:
            - name: *internal_network
        subnets:
            - name: "private_subnet"
              network_name: *internal_network
              cidr: 192.168.100.0/22
        routers:
            - name: *internal_network
              network: 38.145.32.0/22
              interfaces:
                  - "private_subnet"
        servers:
            # Fixed ip servers first
            - name: bastion
              image: *default_image
              flavor: *default_flavor
              key_name: *bastion_key
              security_groups:
                - *ssh_from_everywhere
              nics: *internal_nics
            # floating_ips:
            #   - *bastion_public_ip
            - name: test_server
              image: *default_image
              flavor: *default_flavor
              key_name: *servers_key
              security_groups:
                  - *ssh_from_bastion
              volumes:
                - display_name: &test_server_volume test
                  display_description: test
                  size: 80
                  #floating_ips:
                  #- 1.2.3.4
              nics: *internal_nics
            #- *promoter-server
            #            - dns
            #            - sova1
            #            - sova2
            #            - sova3
            #            - bastion
#    openstack-nodepool:
#        networks:
#            - internal
#            - external
#        servers:
#            - te-broker
