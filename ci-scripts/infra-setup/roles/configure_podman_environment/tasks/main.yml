---
- become: yes
  block:
    - name: Install Podman
      ansible.builtin.dnf:
        name:
          - podman
        state: present

    - name: Start the Podman system service
      ansible.builtin.systemd:
        name: podman
        state: started

    - name: Verify the service running
      ansible.builtin.uri:
        url: http://localhost/_ping
        headers:
          Content-Type: "application/json"
        unix_socket: "/var/run/docker.sock"
        return_content: yes

    - name: Emulate Docker CLI using podman. Quiet the msg.
      ansible.builtin.file:
        path: /etc/containers/nodocker
        state: touch

    - name: Install docker-compose with pip
      pip:
        name: docker-compose
        extra_args: --user

    - name: Login to Docker Hub
      community.docker.docker_login:
        registry_url: "https://registry.hub.docker.com"
        username: "{{ dockerhub_username }}"
        password: "{{ dockerhub_password }}"
