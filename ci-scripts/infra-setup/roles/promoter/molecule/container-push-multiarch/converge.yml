- name: Download and repush container images to secure registries without multi-arch manifests
  hosts: all
  vars:
    # The way the container-push works, there's currently no way to test the vars lookup directly
    # so we are passing the vars directly here, but this reduces coverage: if we
    # change the lookup, they don't get any test
    # Unfortunately adding coverage for those requires a refactoring of the way vars are passed
    # to the container-push in general, which is way too difficult to do right now.
    release: master
    named_label: triple-ci-staging-promoted
    # full_hash is provided by the staging environment
    script_root: UNUSED
    distro_name: centos
    distro_version: 8
    containers_file: "parsed_containers-{{ distro_name }}-{{ distro_version }}-{{ release }}.txt"
    # Source and target registries are provided by staging environment
    manifest_push: true
    ppc_manifests: true
    # Decrease the chance the ppc_manifests is disabled by our check
    ppc_pull_attempts: 3
    containers_list:
      - nova-compute
      - neutron-server
  tasks:
    - include_tasks: ../container-push/converge-common.yml
