---
- hosts: all
  tasks:
    - name: call tasks to manage variables
      include_tasks: ../provision/manage_variables.yml

    - include_tasks: "{{ ci_config_remote_src_dir }}/playbooks/common_tasks/promotion-common-tasks-pre.yml"

    - include_role:
        name: promoter
        tasks_from: repos-packages
    - include_role:
        name: promoter
        tasks_from: update_credentials
    - include_role:
        name: promoter
        tasks_from: docker

    - name: launch staging setup scripts
      shell: |
        source /home/{{ promoter_user }}/promoter_venv/bin/activate
        /home/{{ promoter_user }}/promoter_venv/bin/python3 \
            {{ ci_config_remote_src_dir }}/ci-scripts/dlrnapi_promoter/stage.py setup \
                --scenes dlrn,registries,containers
