---
- name: launch staging setup scripts
  shell: |
    # Export the path to the mounted docker socket so all docker client commands will use it
    {{ ansible_python_interpreter }} \
    ../../../../../dlrnapi_promoter/tests/staging-setup/staging_environment.py setup --components registries,container-images
  changed_when: true

- name: include stage setup variables
  include_vars: /tmp/stage-info.yaml

- name: sets critical variables
  set_fact:
    full_hash: "{{ promotions.promotion_candidate.full_hash }}"
    source_registry: "{{ registries.source }}"
    target_registries: "{{ registries.targets }}"
