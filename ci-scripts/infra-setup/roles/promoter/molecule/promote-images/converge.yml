---
- hosts: all
  tasks:
    - name: call tasks to manage variables
      include_tasks: ../provision/manage_variables.yml

    # Setup the promoter-staging environment (--scenes 'overcloud-images')
    # then run ci-config/ci-scripts/promote-images.sh
    - name: Test promoter container manifest-push.yml
      block:
        - name: launch staging setup scripts
          shell: |
            source /home/{{ promoter_user }}/promoter_venv/bin/activate
            # Export the path to the mounted docker socket so all docker
            # client commands will use it
            /home/{{ promoter_user }}/promoter_venv/bin/python3 \
                {{ ci_config_remote_src_dir }}/ci-scripts/dlrnapi_promoter/stage.py \
                    setup --scenes dlrn,overcloud_images
