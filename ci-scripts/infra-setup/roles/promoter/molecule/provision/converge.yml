---
- hosts: localhost
  tasks:
#
# While testing, we usually not provisioning a second disk for the server
# So we emulate the second disk with a loopback device
#

    - name: Begin production code
      become: true
      block:
        - name: Promoter provisioning
          include_role:
            name: promoter
            tasks_from: setup_loop
          tags:
            - provisioning

        - name: promoter staging provisioning
          include_role:
            name: promoter
          vars:
            run_service: false
          tags:
            - provisioning

        - name: Run credentials setup
          include_role:
            name: promoter
            tasks_from: update_credentials
          tags:
            - provisioning
