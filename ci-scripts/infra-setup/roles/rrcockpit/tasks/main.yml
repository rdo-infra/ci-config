---
- name: Setup podman
  include_role:
    name: podman_compose

- name: Login to Docker.io
  containers.podman.podman_login:
    username: "{{ dockerhub_username }}"
    password: "{{ dockerhub_password }}"
    registry: docker.io

- name: Create required podman volumes
  containers.podman.podman_volume:
    name: "{{ item }}"
    state: present
  with_items:
    - influxdb-volume
    - grafana-volume
    - telegraf-volume

- name: Generate custom nginx.conf to be included into container
  template:
    src: nginx.conf.j2
    dest: "/tmp/infra-setup/roles/rrcockpit/files/nginx.conf"

- name: Start services if configured so
  include_tasks: start_services.yml
  when: start_services|default(true)|bool
