- name:
  os_security_group:
    auth:
        tenant_name: "{{ tenant.key }}"
    name: "{{ item.name }}"
    description: "{{ item.description|default(omit) }}"
  with_items: "{{ tenant.value.security_groups }}"

- name:
  os_security_group_rule:
    auth:
        tenant_name: "{{ tenant.key }}"
    state: present
    security_group: "{{ item.security_group }}"
    protocol: "{{ item.protocol|default(omit) }}"
    remote_ip_prefix: "{{ item.remote_ip_prefix|default(omit) }}"
    port_range_min: "{{ item.port_range_min|default(omit) }}"
    port_range_max: "{{ item.port_range_max|default(omit) }}"
    direction: "{{ item.direction|default(omit) }}"
    ethertype: "{{ item.ethertype|default(omit) }}"
  with_items: "{{ tenant.value.security_rules }}"

