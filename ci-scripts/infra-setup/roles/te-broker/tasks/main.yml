---
- become: true
  block:

  - name: Install required packages
    package:
      name: 'epel-release'
      state: present

  - name: Install required packages
    package:
      name: '{{ item }}'
      state: present
    with_items:
      - git
      - vim
      - python-pip
      - python-heatclient
      - python-neutronclient
      - python-novaclient
      - python-swiftclient
      - python-openstackclient

  - name: Deploy ovb-tenant-cleanup.sh
    copy:
      src: ../infra-cleanup/ovb-tenant-cleanup.sh
      dest: /root/ovb-tenant-cleanup.sh
      mode: 0774

  - name: Create cron job to clean OVB old stacks
    cron:
      name: 'Cleaning old OVB stacks'
      minute: 0
      job: 'systemd-cat -t ovb-tenant-cleanup bash /root/ovb-tenant-cleanup.sh'
