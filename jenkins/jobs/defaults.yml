- defaults:
    name: parent-promote-defaults
    description: |
      <h3> Documentation: <a href=http://www.rdoproject.org/>http://www.rdoproject.org/</a> </h3>
      <h3> Known issues: Master <a href=https://etherpad.openstack.org/p/delorean_master_current_issues>link</a> </h3>
      <h3> Known issues with previous releases: <a href=https://etherpad.openstack.org/p/delorean_previous_releases_current_issues</a> </h3>
    concurrent: false
    node: rdo
    logrotate:
        daysToKeep: 5
        artifactDaysToKeep: 5
    wrappers:
        - ansicolor
        - timestamps
        - workspace-cleanup

- defaults:
    name: script-defaults
    concurrent: false
    node: rdo
    logrotate:
        daysToKeep: 5
        artifactDaysToKeep: 5
    wrappers:
        - ansicolor
        - timestamps
        - workspace-cleanup
        - timeout:
            type: absolute
            timeout: 15
            fail: true

- scm:
    name: 'ci-config-gate-repository'
    scm:
        - git:
            basedir: 'ci-config'
            url: 'ssh://rdo-ci-centos@review.gerrithub.io:29418/rdo-infra/ci-config.git'
            branches:
                - "$GERRIT_BRANCH"
            credentials-id: 'aeb3af4f-6985-4c8f-8261-ec37cacad10b'
            branches:
                - '$GERRIT_BRANCH'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: gerrit
            skip-tag: true

- trigger:
    name: 'ci-config-gate-trigger'
    triggers:
        - gerrit:
            server-name: 'rdo-ci-centos'
            trigger-on:
                - patchset-created-event
                - draft-published-event
                - comment-added-contains-event:
                    comment-contains-value:  '(?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*(recheck)'
            projects:
                - project-compare-type: 'PLAIN'
                  project-pattern: 'rdo-infra/ci-config'
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'master'
            skip-vote:
                successful: false
                failed: false
                unstable: false
                notbuilt: false
            failure-message: 'Test failed'
            successful-message: 'Test ran successfully'
            unstable-message: 'Test is unstable'
            silent: false
            silent-start: true
