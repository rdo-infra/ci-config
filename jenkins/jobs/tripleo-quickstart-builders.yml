- builder:
    name: 'tripleo-quickstart-builder'
    builders:
        - shell: |
              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type}

              popd

- builder:
    name: 'tripleo-quickstart-upgrade-builder'
    builders:
        - shell: |
              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type} \
                {upgrade_delorean_hash} \
                {major_upgrade} \
                {enable_pacemaker} \
                {target_upgrade_version}

              popd

- builder:
    name: 'tripleo-quickstart-tempest-builder'
    builders:
        - shell: |

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              export OPT_ADDITIONAL_PARAMETERS=" -e enable_cinder_backup=true -e test_ping=false -e tempest_config=true -e run_tempest=true -e test_regex={test_regex}"

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type}

              popd

              # when running tempest, do not fail the job based on the deployment
              # the result will be determined by tempest results file and will go red if it's not present
              exit 0
