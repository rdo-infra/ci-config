- builder:
    name: 'tripleo-quickstart-builder'
    builders:
        - shell: |
              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type}

              popd

- builder:
    name: 'tripleo-quickstart-upgrade-builder'
    builders:
        - shell: |
              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type} \
                {upgrade_delorean_hash} \
                {major_upgrade} \
                {enable_pacemaker} \
                {target_upgrade_version}

              popd

- builder:
    name: 'tripleo-quickstart-full-tempest-builder'
    builders:
        - shell: |

              git clone https://github.com/redhat-openstack/ansible-role-tripleo-collect-logs.git
              pushd ansible-role-tripleo-collect-logs
              git remote add gerrit https://review.gerrithub.io/redhat-openstack/ansible-role-tripleo-collect-logs
              git fetch --all
              git review -d I0eccf093f6ca12ca6ff1d4697b6d64f20dca2e69
              popd

              sed -i 's/git+https:\/\/github.com\/redhat-openstack\/ansible-role-tripleo-collect-logs.git\/#egg=ansible-role-tripleo-collect-logs//g' $WORKSPACE/tripleo-quickstart/quickstart-extras-requirements.txt
              echo "file://$WORKSPACE/ansible-role-tripleo-collect-logs/#egg=ansible-role-tripleo-collect-logs" >> $WORKSPACE/tripleo-quickstart/quickstart-extras-requirements.txt

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/get-node.sh
              export VIRTHOST=$(head -n1 $WORKSPACE/virthost)
              echo $VIRTHOST

              pushd $WORKSPACE/tripleo-quickstart

              export OPT_ADDITIONAL_PARAMETERS=" -e test_ping=false -e tempest_config=true -e run_tempest=true -e test_regex=.*"

              bash $WORKSPACE/tripleo-quickstart/ci-scripts/{test}.sh \
                {release} \
                {build_system} \
                {topology} \
                {job_type}

              popd

              # when running tempest, do not fail the job based on the deployment
              # the result will be determined by tempest results file and will go red if it's not present
              exit 0

