- job-template:
    name: 'tripleo-quickstart-promote-{release}-{build_system}-{topology}'
    defaults: 'tripleo-quickstart-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job runs the playbook <a href="https://github.com/openstack/tripleo-quickstart/blob/master/playbooks/quickstart.yml" target="_blank">quickstart.yml</a></p>
        In order to run this job locally using quickstart.sh:
        <pre>

        export VIRTHOST='my-cool-virthost.example.com'

        bash quickstart.sh \
        -u "http://artifacts.ci.centos.org/artifacts/rdo/images/{release}/{build_system}/testing/undercloud.qcow2" \
        -t all \
        -c centosci/{topology}.yml \
        $VIRTHOST {release}

        </pre>
    scm:
        - repo-tripleo-quickstart
        - repo-khaleesi
    builders:
        - tripleo-quickstart-promote-builder:
            release: '{release}'
            build_system: '{build_system}'
            topology: '{topology}'

- job-template:
    name: 'tripleo-quickstart-promote-{release}-{build_system}-build-images'
    defaults: 'tripleo-quickstart-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job runs the playbook <a href="https://github.com/openstack/tripleo-quickstart/blob/master/playbooks/build-images.yml" target="_blank">build-images.yml</a></p>
        In order to run this job locally:
        <pre>

        # It is assumed that tripleo-quickstart is installed in the default
        # virtualenv created by running quickstart.sh
        # (however quickstart.sh does not yet support building images)
        source $HOME/.quickstart/bin/activate
        export VIRTHOST='my-cool-virthost.example.com'
        export ANSIBLE_CONFIG=$HOME/.quickstart/tripleo-quickstart/ansible.cfg

        # For delorean, find the delorean hash from this job:
        # https://ci.centos.org/job/rdo-promote-get-hash-{release}/
        export dlrn_hash=\<hash from above job\>

        ansible-playbook -i local_hosts $HOME/.quickstart/tripleo-quickstart/playbooks/build-images.yml \
        --extra-vars virthost=$VIRTHOST \
        --extra-vars artib_release={release} \
        --extra-vars artib_build_system={build_system} \
        --extra-vars artib_delorean_hash=$dlrn_hash

        # The images will be in /var/lib/oooq-images dir on the virthost

        </pre>
    scm:
        - repo-tripleo-quickstart
        - repo-khaleesi
    builders:
        - tripleo-quickstart-images-promote-builder:
            release: '{release}'
            build_system: '{build_system}'
