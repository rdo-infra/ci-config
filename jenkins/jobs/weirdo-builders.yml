- builder:
    name: 'weirdo-gate-tox'
    builders:
        - shell: |
            # Use WeIRDO provided by jenkins scm
            cd weirdo
            git log -n 5 --oneline

            tox -e {test}

- builder:
    name: 'weirdo-checkout-gate-repositories'
    builders:
      - python:
          !include-raw:
            - scripts/checkout-weirdo-gate-repositories.py

- builder:
    name: 'weirdo-ansible-playbook-builder'
    builders:
        - shell: |
            # Use WeIRDO provided by jenkins scm
            cd weirdo
            git log -n 5 --oneline

            tox -e ansible-playbook -- -vv playbooks/{playbook}.yml -e ci_environment=ci-centos -e openstack_release={openstack_release}

- builder:
    name: 'weirdo-generic-ansible-playbook-builder'
    builders:
        - shell: |
            # Use WeIRDO provided by jenkins scm
            cd weirdo
            git log -n 5 --oneline

            tox -e ansible-playbook -- -vv playbooks/{playbook}.yml -e ci_environment=ci-centos -e delorean_url=${{delorean_url}} -e delorean_deps_url=${{delorean_deps_url}}

- builder:
    name: 'weirdo-promote-ansible-playbook-builder'
    builders:
        - shell: |
            # Use variables provided by a job earlier in the pipeline, if available
            delorean_hash=${{delorean_current_hash:-current}}
            delorean_url="http://trunk.rdoproject.org/centos7-{openstack_release}/${{delorean_hash}}/delorean.repo"

            # Use WeIRDO provided by jenkins scm
            cd weirdo
            git log -n 5 --oneline

            tox -e ansible-playbook -- -vv playbooks/{playbook}.yml -e ci_environment=ci-centos -e delorean_url=$delorean_url -e openstack_release={openstack_release}

- builder:
    name: 'weirdo-generate-log-redirection'
    builders:
        - shell: |
            ARTIFACT_URL="https://ci.centos.org/artifacts/rdo"

            cat << EOF > "${WORKSPACE}/logs.html"
            <!DOCTYPE HTML>
            <html lang="en-US">
                <head>
                    <meta charset="UTF-8">
                    <meta http-equiv="refresh" content="1;url=${ARTIFACT_URL}/${JOB_NAME}/${BUILD_NUMBER}">
                    <script type="text/javascript">
                        window.location.href = "${ARTIFACT_URL}/${JOB_NAME}/${BUILD_NUMBER}"
                    </script>
                    <title>Redirection to logs</title>
                </head>
                <body>
                    If you are not redirected automatically, follow the <a href="${ARTIFACT_URL}/${JOB_NAME}/${BUILD_NUMBER}">link to the logs</a>.
                </body>
            </html>
            EOF
