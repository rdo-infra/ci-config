- job-template:
    name: 'weirdo-{openstack_release}-gate-kolla-{scenario}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/ansible-role-weirdo-kolla" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/kolla-{scenario}.yml" target="_blank">kolla-{scenario}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        [[ "{openstack_release}" != "master" ]] && version="stable/{openstack_release}"

        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/kolla-{scenario}.yml -e ci_environment=ci-centos -e openstack_release={openstack_release} -e version=$version
        </pre>

    triggers:
        - weirdo-kolla-gate-integration-trigger
    builders:
        - weirdo-checkout-gate-repositories
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-ansible-playbook-builder:
            openstack_release: '{openstack_release}'
            playbook: 'kolla-{scenario}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node

- job-template:
    name: 'weirdo-{openstack_release}-gate-packstack-{scenario}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/ansible-role-weirdo-packstack" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/packstack-{scenario}.yml" target="_blank">packstack-{scenario}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        if [[ "{openstack_release}" != "master" ]]; then
            version="stable/{openstack_release}"
        else
            version="{openstack_release}"
        fi

        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/packstack-{scenario}.yml -e ci_environment=ci-centos -e openstack_release={openstack_release} -e version=$version
        </pre>

    triggers:
        - weirdo-packstack-gate-integration-trigger
    builders:
        - weirdo-checkout-gate-repositories
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-ansible-playbook-builder:
            openstack_release: '{openstack_release}'
            playbook: 'packstack-{scenario}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node

- job-template:
    name: 'weirdo-{openstack_release}-gate-puppet-openstack-{scenario}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/ansible-role-weirdo-puppet-openstack" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/puppet-openstack-{scenario}.yml" target="_blank">puppet-openstack-{scenario}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        if [[ "{openstack_release}" != "master" ]]; then
            version="stable/{openstack_release}"
        else
            version="{openstack_release}"
        fi

        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/puppet-openstack-{scenario}.yml -e ci_environment=ci-centos -e openstack_release={openstack_release} -e version=$version
        </pre>

    triggers:
        - weirdo-puppet-openstack-gate-integration-trigger
    builders:
        - weirdo-checkout-gate-repositories
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-ansible-playbook-builder:
            openstack_release: '{openstack_release}'
            playbook: 'puppet-openstack-{scenario}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node

- job-template:
    name: 'weirdo-gate-tox-{test}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job gates against commits done to <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <br>
        This is what this job runs:
        <pre>
        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e {test}
        </pre>

    triggers:
          - weirdo-gate-trigger
    builders:
        - weirdo-checkout-gate-repositories
        - weirdo-gate-tox:
            test: '{test}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores

- job-template:
    name: 'weirdo-{openstack_release}-periodic-{playbook}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job periodically runs <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/{playbook}.yml" target="_blank">{playbook}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        if [[ "{openstack_release}" != "master" ]]; then
            version="stable/{openstack_release}"
        else
            version="{openstack_release}"
        fi

        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/{playbook}.yml -e ci_environment=ci-centos -e openstack_release={openstack_release} -e version=$version
        </pre>

    triggers:
          - weirdo-periodic-trigger
    scm:
        - weirdo-core-master-repository
    builders:
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-ansible-playbook-builder:
            openstack_release: '{openstack_release}'
            playbook: '{playbook}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node

- job-template:
    name: 'weirdo-{openstack_release}-promote-{playbook}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job runs <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/{playbook}.yml" target="_blank">{playbook}.yml</a></p>
        <br>
        This is what this job runs:
        <pre>
        if [[ "{openstack_release}" != "master" ]]; then
            version="stable/{openstack_release}"
        else
            version="{openstack_release}"
        fi

        # Use variables provided by a job earlier in the pipeline, if available
        delorean_hash=${{delorean_current_hash:-current}}
        delorean_url="http://trunk.rdoproject.org/centos7-{openstack_release}/${{delorean_hash}}/delorean.repo"

        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/{playbook}.yml -e ci_environment=ci-centos -e delorean_url=$delorean_url -e openstack_release={openstack_release} -e version=$version
        </pre>

    scm:
        - weirdo-core-master-repository
    builders:
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-promote-ansible-playbook-builder:
            openstack_release: '{openstack_release}'
            playbook: '{playbook}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node

- job-template:
    name: 'weirdo-generic-{playbook}'
    defaults: 'weirdo-defaults'
    description: |
        <p>Managed by Jenkins Job Builder. Do not edit via web.</p>
        <br>
        <p>This job runs <a href="https://github.com/redhat-openstack/weirdo" target="_blank">WeIRDO</a>.</p>
        <p>It runs the playbook <a href="https://github.com/redhat-openstack/weirdo/blob/master/playbooks/{playbook}.yml" target="_blank">{playbook}.yml</a></p>
        <br>
        This is a <strong>parameterized</strong> job that requires two variables: delorean_url and delorean_deps_url.
        This is what this job runs:
        <pre>
        # Use WeIRDO provided by jenkins scm
        cd weirdo
        git log -n 5 --oneline

        tox -e ansible-playbook -- -vv -i hosts playbooks/{playbook}.yml -e delorean_url=${{delorean_url}} -e delorean_deps_url=${{delorean_deps_url}} -e version=${{version}}
        </pre>

    parameters:
        - string:
            name: delorean_url
            default: http://trunk.rdoproject.org/centos7-mitaka/current-passed-ci/delorean.repo
            description: The URL of the delorean .repo file tested against
        - string:
            name: delorean_deps_url
            default: http://trunk.rdoproject.org/centos7-mitaka/delorean-deps.repo
            description: The URL of the delorean-deps .repo file tested against
        - string:
            name: version
            default: master
            description: Version of integration tests used (master, stable/mitaka, etc.)
    scm:
        - weirdo-core-master-repository
    builders:
        - weirdo-generate-log-redirection
        - weirdo-get-node
        - weirdo-generic-ansible-playbook-builder:
            playbook: '{playbook}'
    properties:
        - ownership:
            owner: dms@redhat.com
    publishers:
        - weirdo-email-cores
        - weirdo-archive-logs
        - weirdo-release-node