- job-template:
    name: 'weirdo-testing-{openstack_release}'
    defaults: weirdo-defaults
    description: |
        <h3> Documentation: <a href=http://www.rdoproject.org/>http://www.rdoproject.org/</a> </h3>
        This job runs WeIRDO scenarios against a testing release every two days.
    parameters:
        - string:
            name: openstack_release
            default: '{openstack_release}'
            description: The name of the OpenStack release to use (newton, mitaka, etc.)
        - string:
            name: version
            default: 'stable/{openstack_release}'
            description: The version of integration tests to use (stable/newton, stable/mitaka, etc.)
        - string:
            name: testing_repositories
            default: 'https://rdoproject.org/repos/openstack-{openstack_release}/rdo-release-{openstack_release}.rpm'
            description: Release package/RPM to use (can also be an URL)
    triggers:
        - timed: 'H H H/2 * *'
    builders:
        - shell: |
            #!/bin/bash
            echo "+===============================================+"
            echo "| Scheduling jobs to test:"
            echo "|   - openstack_release: $openstack_release"
            echo "|   - version: $version"
            echo "|   - testing_repositories: $testing_repositories"
            echo "+===============================================+"
        - trigger-builds:
            - project:
                - 'weirdo-generic-puppet-openstack-scenario001'
                - 'weirdo-generic-puppet-openstack-scenario002'
                - 'weirdo-generic-puppet-openstack-scenario003'
                - 'weirdo-generic-packstack-scenario001'
                - 'weirdo-generic-packstack-scenario002'
                - 'weirdo-generic-packstack-scenario003'
              predefined-parameters: |
                  openstack_release=$openstack_release
                  version=$version
                  testing_repositories=$testing_repositories
              block: true
              block-thresholds:
                build-step-failure-threshold: 'FAILURE'
                unstable-threshold: 'FAILURE'
                failure-threshold: 'FAILURE'
    publishers:
        - email:
            recipients: 'rdo-infra-list@redhat.com'
