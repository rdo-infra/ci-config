---
- hosts: instance
  tasks:

    # setup staging promoter
    - include_tasks: ../promoter/prepare.yml
    - include_tasks: ../promoter/converge.yml

    - name: Provision staging promoter
      block:
        - name: launch staging setup scripts
          shell: |
            source /home/{{ promoter_user }}/promoter_venv/bin/activate
            /home/{{ promoter_user }}/promoter_venv/bin/python3 \
                {{ ci_config_remote_src_dir }}/ci-scripts/dlrnapi_promoter/stage.py \
                    setup --scenes dlrn,overcloud_images
