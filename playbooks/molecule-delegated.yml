---
- hosts: all
  environment:
    ANSIBLE_LOG_PATH: "{{ ansible_user_dir }}/zuul-output/logs/ansible-execution.log"
    # See https://click.palletsprojects.com/en/7.x/python3/
    LC_ALL: C.UTF-8
    LANG: C.UTF-8

  tasks:
    - name: Run role test job
      shell: |-
        . {{ ansible_user_dir }}/test-python/bin/activate
        # commands set in job definition vars so this file can be common
        {{ molecule_test_commands }}
      args:
        chdir: "{{ ansible_user_dir }}/{{ zuul.project.src_dir }}/roles/promoter"
        executable: /bin/bash
      changed_when: false
