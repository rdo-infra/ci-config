- job:
    name: mol
    abstract: true
    nodeset: rdo-centos-7
    vars:
      # longer -k match avoids accidental inclusion of more than one scenario
      tox_extra_args: "-- -k {{ mol_scenario }}/molecule.yml"
      tox_environment:
        # See https://click.palletsprojects.com/en/7.x/python3/
        LC_ALL: en_US.utf8
        LANG: en_US.utf8
      # avoids an error with "Run tox without tests" due to implicit use of 'venv' in zuul-job
      tox_envlist: molecule
    # pre assures instance/tester hostnames resolve
    pre-run: playbooks/mol/pre.yml
    # Our run avoids calling revoke-sudo
    run: playbooks/mol/run.yml
    # custom post will make reports.html visible in zuul UI
    post-run: playbooks/mol/post.yml

- job:
    name: mol-provision-promoter
    description: Tests promoter deployment role.
    parent: mol
    vars:
      mol_scenario: provision_promoter
    files: &promoter
      - .*promoter.*
      - ^requirements.txt
      - ^setup.cfg
      - ^setup.py
      - ^test-requirements.txt
      - ^tox.ini

- job:
    name: mol-promote-images
    description: Tests promote images workflow.
    parent: mol
    vars:
      mol_scenario: promote_images
    files: *promoter
